# URL-Alias-Service
**Cервис преобразования длинных URL в короткие уникальные URL.**
---

Для работы сервиса необходимы Docker с Docker Compose, утилита make.

Сервис использует web-фреймворк Flask и реляционную СУБД MySQL.

## Работа с сервисом

**Замечание: сервис готов к использованию и `.env` уже содержит необходимые чувствительные данные. Для личного использования не публикуйте `.env`, вместо этого используйте `.env.example` с шаблоном переменных среды.**

### Первый запуск
Для первого запуска сервиса выполните команду в папке `URL-Alias-Service`:
```
make all
```
Во время выполнения Вас попросят ввести имя пользователя и его пароль. После каждого введения нажимайте `Enter`.

### Остановка сервиса
Для остановки сервиса выполните команду в папке `URL-Alias-Service`:
```
make stop
```

### Повторный запуск сервиса
Для повторного запуска сервиса выполните команду в папке `URL-Alias-Service`:
```
make run
```

### Создание пользователя на сервисе
Для создания пользователя на сервисе выполните команду в папке `URL-Alias-Service`:
```
make create-user
```
Вас попросят ввести имя пользователя и пароль. После каждого введения нажимайте `Enter`.

## Пользовательские возможности

### Документация SwaggerOpenAPI Docs
Открыть документацию можно по адресу `http://localhost:8000/docs`. 

С помощью страницы можно также работать с сервисом.

Неавторизованный пользователь может только перенаправляться с короткого URL сервиса на оригинальный URL. Если проводить запрос через Swagger, то ожидаемое корректное поведение:
```
Failed to fetch.
Possible Reasons:

CORS
Network Failure
URL scheme must be "http" or "https" for CORS request.
```

Чтобы авторизоваться на `http://localhost:8000/docs` нужно нажать кнопку `Authorize`, ввести данные пользователя и нажать новую кнопку `Authorize`. Можно также выйти из авторизованного аккаунта с помощью кнопки `Logout`. Проверяйте внимательно вводимые данные, ибо они должны совпадать с данными существующих пользователей на сервисе.

### Основные действия с сервисом
GET `http://localhost:8000/service` - возвращает все короткие ссылки на сервисе в формате JSON:
```
{
  "items": [
    {
      "url": "http://localhost:8000/service/short_code",
      "orig_url": "https://example.com",
      "create_time": "2025-06-07T16:42:36",
      "expire_time": "2025-06-08T16:42:36",
      "is_active": true/false
    },
    ...
  ],
  "total_items": N,
  "page": N,
  "total_pages": N
}
```
items содержит существующие короткие URL, и соответствующие им оригинальные, также время создания, время устаревания и режим активности.

total_items - количество коротких URL в сервисе.

page - текущая страница вывода URL, а total_pages - общее число страниц.

При запросе можно задать параметры page для табуляции, per_page для количества записей на странице и is_active для фильтрации активных коротких URL.

POST `http://localhost:8000/service` создает короткий URL с периодом устаревания в один день на основе переданного `orig_url`.

GET `http://localhost:8000/service/stats` возвращает статистику по всем коротким URL в порядке от самых посещаемых к менее посещаемым в формате JSON:
```
[
  {
    "url": "http://localhost:8000/service/short_code",
    "orig_url": "https://example.com",
    "last_hour_clicks": N,
    "last_day_clicks": N
  },
  ...
]
```

GET `http://localhost:8000/service/short_code` - перенаправляет с короткого URL на оригинальный URL, где short_code - код короткого URL, соответствующий оригинальному URL. Если такого короткого URL нет, он устарел или был отключен, то перенаправления не будет, а пользователь получит соответствующий ответ `URL not found`/`URL expired`/`URL deactivated`

PUT `http://localhost:8000/service/short_code/deactivate` - отключает короткий URL с кодом `short_code`, соотвественно перенаправление работать больше не будет, а пользователь получит, соответствующий ответ `URL deactivated`.